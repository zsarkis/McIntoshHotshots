@page "/"
@using McIntoshHotshots.Model
@using McIntoshHotshots.Repo
@using McIntoshHotshots.Services
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider _authenticationStateProvider
@inject IPlayerRepo _playerRepo

<PageTitle>McIntosh Hotshots - Dart Tournament Series</PageTitle>

<div class="home-container fade-in">
    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <div class="hero-badge">
                <i class="fas fa-bullseye"></i>
                Professional Dart Tournaments
            </div>
            <h1 class="hero-title">
                McIntosh <span class="gradient-text">Hotshots</span>
            </h1>
            <p class="hero-subtitle">
                Experience competitive dart gaming at its finest. Join tournaments, track stats, 
                and compete with players from around the world.
            </p>
            <div class="hero-actions">
                <a href="/live-scoring" class="btn btn-primary hero-btn-primary">
                    <i class="fas fa-play"></i>
                    Start Playing
                </a>
                <a href="/tournaments" class="btn btn-secondary hero-btn-secondary">
                    <i class="fas fa-trophy"></i>
                    View Tournaments
                </a>
            </div>
            <div class="hero-stats">
                <div class="stat-item">
                    <div class="stat-number">@PlayersDisplay</div>
                    <div class="stat-label">Players</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">@TournamentsDisplay</div>
                    <div class="stat-label">Tournaments</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">@GamesPlayedDisplay</div>
                    <div class="stat-label">Games Played</div>
                </div>
            </div>
        </div>
        <div class="hero-visual">
            <div class="dartboard-container">
                <div class="dartboard">
                    <div class="dartboard-inner">
                        <div class="dartboard-center">
                            <div class="bullseye"></div>
                        </div>
                    </div>
                </div>
                <div class="floating-elements">
                    <div class="floating-dart"></div>
                    <div class="floating-dart"></div>
                    <div class="floating-dart"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features-section">
        <div class="section-header">
            <h2>Everything You Need to Compete</h2>
            <p>Professional tournament management with real-time scoring and comprehensive analytics</p>
        </div>
        
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3>Live Scoring</h3>
                <p>Real-time tournament scoring with instant updates and live leaderboards</p>
                <a href="/live-scoring" class="feature-link">
                    Try Live Scoring <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <h3>AI Coaching</h3>
                <p>Get personalized coaching tips and strategies from our AI-powered dart coach</p>
                <a href="/coaching" class="feature-link">
                    Start Coaching <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <h3>Tournaments</h3>
                <p>Join competitive tournaments with players of all skill levels and win prizes</p>
                <a href="/tournaments" class="feature-link">
                    View Tournaments <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <h3>Analytics</h3>
                <p>Track your progress with detailed statistics and performance analytics</p>
                <a href="/player-stats" class="feature-link">
                    View Stats <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </section>

    <!-- Tournaments Section -->
    <section class="tournaments-section">
        <div class="section-header">
            <h2>Upcoming Tournaments</h2>
            <p>Join exciting tournaments and compete for prizes</p>
        </div>
        
        <div class="tournaments-grid">
            <div class="tournament-card featured">
                <div class="tournament-badge">Featured</div>
                <div class="tournament-icon">
                    <i class="fas fa-fire"></i>
                </div>
                <h3>Monday Madness</h3>
                <p class="tournament-level">Intermediate Level</p>
                <p class="tournament-description">
                    Join the Monday Madness tournament and showcase your dart skills among the best players!
                </p>
                <div class="tournament-details">
                    <div class="tournament-detail">
                        <i class="fas fa-calendar"></i>
                        <span>April 12th</span>
                    </div>
                    <div class="tournament-detail">
                        <i class="fas fa-dollar-sign"></i>
                        <span>$20 Entry</span>
                    </div>
                    <div class="tournament-detail">
                        <i class="fas fa-users"></i>
                        <span>16 Slots</span>
                    </div>
                </div>
                <button class="btn btn-primary tournament-btn">
                    Register Now <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            
            <div class="tournament-card">
                <div class="tournament-badge">Championship</div>
                <div class="tournament-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <h3>Weekend Showdown</h3>
                <p class="tournament-level">Advanced Level</p>
                <p class="tournament-description">
                    Compete in the Weekend Showdown to claim the championship title and awesome prizes!
                </p>
                <div class="tournament-details">
                    <div class="tournament-detail">
                        <i class="fas fa-calendar"></i>
                        <span>April 24th</span>
                    </div>
                    <div class="tournament-detail">
                        <i class="fas fa-dollar-sign"></i>
                        <span>$30 Entry</span>
                    </div>
                    <div class="tournament-detail">
                        <i class="fas fa-users"></i>
                        <span>24 Slots</span>
                    </div>
                </div>
                <button class="btn btn-secondary tournament-btn">
                    Register Now <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <div class="tournaments-footer">
            <a href="/tournaments" class="btn btn-ghost">
                View All Tournaments <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section">
        <div class="cta-content">
            <h2>Ready to Start Your Journey?</h2>
            <p>Join thousands of players in competitive dart tournaments</p>
            <div class="cta-actions">
                <a href="/register" class="btn btn-primary cta-btn">
                    <i class="fas fa-user-plus"></i>
                    Create Account
                </a>
                <a href="/live-scoring" class="btn btn-ghost cta-btn">
                    <i class="fas fa-play"></i>
                    Try Demo
                </a>
            </div>
        </div>
        <div class="cta-background">
            <div class="cta-pattern"></div>
        </div>
    </section>
</div>

@inject ITournamentService TournamentService
@inject IPlayerRepo PlayerRepo
@inject IMatchSummaryRepo MatchSummaryRepo

@code
{
    // Properties for dynamic statistics
    public string PlayersDisplay { get; set; } = "Loading...";
    public string TournamentsDisplay { get; set; } = "Loading...";
    public string GamesPlayedDisplay { get; set; } = "Loading...";

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Fetch statistics asynchronously
            await LoadStatisticsAsync();
        }
        catch (Exception ex)
        {
            // Log error and set fallback values
            Console.WriteLine($"Error loading statistics: {ex.Message}");
            SetFallbackValues();
        }
    }

    private async Task LoadStatisticsAsync()
    {
        // Load all statistics in parallel for better performance
        var playersTask = GetPlayersCountAsync();
        var tournamentsTask = GetTournamentsCountAsync();
        var gamesPlayedTask = GetGamesPlayedCountAsync();

        await Task.WhenAll(playersTask, tournamentsTask, gamesPlayedTask);

        // Format the display values
        var playersCount = await playersTask;
        var tournamentsCount = await tournamentsTask;
        var gamesPlayedCount = await gamesPlayedTask;

        PlayersDisplay = FormatNumber(playersCount);
        TournamentsDisplay = tournamentsCount.ToString();
        GamesPlayedDisplay = FormatNumber(gamesPlayedCount);

        // Trigger UI update
        StateHasChanged();
    }

    private async Task<int> GetPlayersCountAsync()
    {
        var players = await PlayerRepo.GetPlayersAsync();
        return players.Count();
    }

    private async Task<int> GetTournamentsCountAsync()
    {
        var tournaments = await TournamentService.GetTournamentsAsync();
        return tournaments.Count;
    }

    private async Task<int> GetGamesPlayedCountAsync()
    {
        var matches = await MatchSummaryRepo.GetMatchSummariesAsync();
        return matches.Count();
    }

    private string FormatNumber(int number)
    {
        if (number >= 1000)
        {
            double rounded = Math.Round(number / 1000.0, 1);
            return $"{rounded}K";
        }
        
        return $"{number}+";
    }

    private void SetFallbackValues()
    {
        PlayersDisplay = "1,250+";
        TournamentsDisplay = "48";
        GamesPlayedDisplay = "5.2K";
    }
}
